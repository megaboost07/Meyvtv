<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mega Store - official</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --bg: #0f172a; 
            --text: #ffffff; 
            --card: rgba(255, 255, 255, 0.1); 
            --primary: #6366f1; 
            --glass-border: rgba(255, 255, 255, 0.2);
            --star: #ffb400; 
        }

        .dark-mode { --bg: #0b0e14; --text: #fff; --card: rgba(255,255,255,0.05); }

        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Inter', sans-serif; transition: 0.3s; }
        
        body { 
            background: var(--bg); 
            color: var(--text); 
            padding-bottom: 120px; 
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.2) 0%, transparent 40%),
                        radial-gradient(circle at 80% 70%, rgba(244, 114, 182, 0.2) 0%, transparent 40%);
            z-index: -1;
            animation: bgMove 15s infinite alternate ease-in-out;
        }

        @keyframes bgMove {
            0% { transform: scale(1) translate(0, 0); }
            100% { transform: scale(1.2) translate(20px, 20px); }
        }

        header { 
            padding: 12px 15px; position: sticky; top: 0; z-index: 1000; 
            background: rgba(15, 23, 42, 0.8); 
            backdrop-filter: blur(15px);
            display: flex; align-items: center; justify-content: space-between; 
            border-bottom: 1px solid var(--glass-border); 
        }

        .brand { font-size: 20px; font-weight: 900; background: linear-gradient(to right, #818cf8, #f472b6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .search-container { 
            background: var(--card); border-radius: 20px; display: flex; align-items: center; 
            padding: 5px 15px; width: 65%; height: 38px; border: 1px solid var(--glass-border);
        }
        .search-container input { border: none; background: transparent; width: 100%; outline: none; color: white; font-size: 14px; margin-left: 8px; }

        .section { margin-top: 25px; padding: 0 15px; }
        .sec-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .sec-title { font-size: 18px; font-weight: 800; border-left: 4px solid var(--primary); padding-left: 10px; }
        .see-more { color: var(--primary); font-size: 13px; font-weight: 700; cursor: pointer; }
        
        .top-banner-row { display: flex; gap: 12px; overflow-x: auto; scrollbar-width: none; padding-bottom: 10px; }
        .top-banner-card { 
            min-width: 280px; height: 160px; border-radius: 20px; 
            background: var(--card); border: 1px solid var(--glass-border); 
            overflow: hidden; position: relative; flex-shrink: 0; cursor: pointer;
            backdrop-filter: blur(10px);
        }
        .top-banner-card img { width: 100%; height: 100%; object-fit: cover; }
        .banner-info { position: absolute; bottom: 0; left: 0; right: 0; padding: 10px; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; font-size: 14px; font-weight: bold; }

        .app-row { display: flex; gap: 15px; overflow-x: auto; scrollbar-width: none; padding-bottom: 10px; }
        .app-card { 
            min-width: 105px; max-width: 105px; text-align: center; cursor: pointer; 
            display: flex; flex-direction: column; align-items: center; 
            background: var(--card); padding: 10px; border-radius: 22px; 
            border: 1px solid var(--glass-border); backdrop-filter: blur(5px);
        }
        .app-card:active { transform: scale(0.95); }
        .icon-box { width: 85px; height: 85px; border-radius: 18px; overflow: hidden; margin-bottom: 8px; box-shadow: 0 8px 32px rgba(0,0,0,0.2); }
        .icon-box img { width: 100%; height: 100%; object-fit: cover; }
        .app-name { font-size: 12px; font-weight: 600; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 2px; }
        .app-star { font-size: 11px; color: var(--star); font-weight: bold; display: flex; align-items: center; gap: 3px; }

        .bottom-nav { 
            position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); 
            width: 90%; background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(20px); border-radius: 30px; 
            display: flex; justify-content: space-around; padding: 12px; 
            border: 1px solid var(--glass-border); box-shadow: 0 10px 40px rgba(0,0,0,0.4); z-index: 2000; 
        }
        .nav-item { text-align: center; color: #888; font-size: 11px; cursor: pointer; flex: 1; }
        .nav-item i { display: block; font-size: 22px; margin-bottom: 5px; }
        .nav-item.active { color: var(--primary); font-weight: bold; text-shadow: 0 0 10px var(--primary); }

        .modal, .modal-full { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index: 5000; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .modal-full { background: var(--bg); overflow-y: auto; padding: 20px; z-index: 6000; flex-direction: column; display: none; }
        .admin-box { background: rgba(30, 41, 59, 0.95); padding: 25px; border-radius: 30px; width: 94%; max-height: 90vh; overflow-y: auto; border: 1px solid var(--glass-border); }
        
        .admin-item-card {
            position: relative; margin-bottom: 12px; height: 60px; border-radius: 15px; overflow: hidden; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; border: 1px solid var(--glass-border);
        }
        .admin-item-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.3; z-index: 0; filter: blur(2px);
        }
        .admin-item-content {
            z-index: 1; display: flex; justify-content: space-between; width: 100%; align-items: center; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .del-btn-new {
            background: rgba(255, 59, 48, 0.8); color: white; border: none; padding: 6px 12px; border-radius: 8px; font-size: 12px; cursor: pointer; backdrop-filter: blur(5px);
        }

        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 15px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.05); color: #fff; outline: none; }
        .btn-download { width: 100%; padding: 15px; background: linear-gradient(to right, #6366f1, #a855f7); color: #fff; border: none; border-radius: 15px; font-weight: bold; font-size: 16px; margin: 20px 0; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4); }
        
        .comment-section { margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--glass-border); }
        .comment-item { background: var(--card); padding: 12px; border-radius: 15px; margin-bottom: 10px; border: 1px solid var(--glass-border); }
        .comment-user { font-weight: bold; color: var(--primary); font-size: 13px; margin-bottom: 4px; }
        .comment-text { font-size: 14px; opacity: 0.9; }

        .stat-box { display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid var(--glass-border); border-bottom: 1px solid var(--glass-border); text-align: center; margin: 10px 0; }

        /* PLAY STORE PHOTO ZOOM STYLE */
        .zoom-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); z-index: 10000; align-items: center; justify-content: center;
        }
        .zoom-overlay img { max-width: 95%; max-height: 80%; border-radius: 10px; box-shadow: 0 0 20px rgba(255,255,255,0.2); }
        .close-zoom { position: absolute; top: 30px; left: 20px; color: white; font-size: 24px; cursor: pointer; }

        .ss-img { height: 220px; border-radius: 10px; cursor: pointer; transition: transform 0.2s; }
        .ss-img:active { transform: scale(0.95); }
    </style>
</head>
<body onload="initApp()"> <header>
    <div class="brand">Mega store</div>
    <div class="search-container">
        <i class="fa-solid fa-magnifying-glass" style="opacity: 0.5;"></i>
        <input type="text" id="searchInput" placeholder="Search..." oninput="doSearch()">
    </div>
    <i class="fa-solid fa-moon" onclick="document.body.classList.toggle('dark-mode')" style="font-size: 22px; cursor: pointer;"></i>
</header>

<div id="search-view" style="display:none; padding: 20px;">
    <h2 style="margin-bottom:15px;">Search Results</h2>
    <div id="searchResults" style="display:grid; grid-template-columns: repeat(3, 1fr); gap: 15px;"></div>
</div>

<div id="home-view">
    <div id="main-content-home">
        <div class="section">
            <div class="sec-header"><div class="sec-title">Top Project</div></div>
            <div id="grid-top" class="top-banner-row"></div>
        </div>
        <div class="section">
            <div class="sec-header"><div class="sec-title">Trending</div><div class="see-more" onclick="goToAll()">See more</div></div>
            <div id="grid-trending" class="app-row"></div>
        </div>
        <div class="section">
            <div class="sec-header"><div class="sec-title">New & Updated</div><div class="see-more" onclick="goToAll()">See more</div></div>
            <div id="grid-new" class="app-row"></div>
        </div>
        <div class="section">
            <div class="sec-header"><div class="sec-title">Editor's choice</div><div class="see-more" onclick="goToAll()">See more</div></div>
            <div id="grid-editor" class="app-row"></div>
        </div>
    </div>
</div>

<div id="all-view" style="display:none; padding: 20px;">
    <h2 style="margin-bottom:15px;">All  project</h2>
    <div id="grid-all" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:15px; row-gap: 25px;"></div>
</div>

<div id="passModal" class="modal">
    <div class="admin-box" style="text-align:center;">
        <h3>Api Access</h3>
        <input type="password" id="adminPass" placeholder="KEY" style="text-align:center;">
        <button class="btn-download" onclick="checkPass()">Login</button>
        <button onclick="closeAll()" style="border:none; background:none; color:#888;">Cancel</button>
    </div>
</div>

<div id="adminModal" class="modal">
    <div class="admin-box">
        <h3>Upload Project</h3>
        <input id="upName" placeholder="Project Name">
        <input id="upDev" placeholder="Developer" value="Sketchwar">
        <input id="upDowns" placeholder="Downloads" value="10K+">
        <input id="upRate" placeholder="Star Rating" value="4.5">
        <input id="upIcon" placeholder="Icon Link">
        <input id="upBanner" placeholder="Banner Link (For Top)">
        <select id="upCat">
            <option>Top Project</option>
            <option>Trending</option>
            <option>New & Updated</option>
            <option>Editor's choice</option>
        </select>
        <textarea id="upDesc" placeholder="Description"></textarea>
        <input id="upLink" placeholder="Download Link">
        
        <button onclick="closeAll()" style="width:100%; border:none; background:rgba(255,255,255,0.1); color:#fff; padding:10px; border-radius:10px; margin-bottom:10px;">Cancel</button>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
            <input id="s1" placeholder="SS 1"><input id="s2" placeholder="SS 2">
            <input id="s3" placeholder="SS 3"><input id="s4" placeholder="SS 4">
            <input id="s5" placeholder="SS 5"><input id="s6" placeholder="SS 6">
        </div>
        <button class="btn-download" onclick="saveData()">Publish</button>
        <h4 style="margin-top:20px; margin-bottom:10px;">Manage Apps</h4>
        <div id="admin-list"></div>
    </div>
</div>

<div id="detailPage" class="modal-full"><div id="detailContent"></div></div>

<div id="zoomOverlay" class="zoom-overlay" onclick="this.style.display='none'">
    <i class="fa-solid fa-arrow-left close-zoom"></i>
    <img id="zoomImg" src="">
</div>

<nav class="bottom-nav">
    <div class="nav-item active" id="nav-home" onclick="tab('home', this)"><i class="fa-solid fa-house"></i>Home</div>
    <div class="nav-item" id="nav-all" onclick="tab('all', this)"><i class="fa-solid fa-layer-group"></i>All apps</div>
    <div class="nav-item" onclick="openPass()"><i class="fa-solid fa-user-shield"></i>Admin</div>
    <div class="nav-item" onclick="window.open('https://t.me/+f8mgewlTOpM2ZTVl')" style="color:#ff4757;"><i class="fa-brands fa-telegram"></i>Telegram</div>
</nav>

<!-- MAIN SCRIPT: converted to module so we can import Firebase modular SDK -->
<script type="module">
    // Firebase modular imports (Realtime Database)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref as dbRef, onValue, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    // --- FIREBASE CONFIG (use the config you already have) ---
    const firebaseConfig = {
      apiKey: "AIzaSyCY6B4hsteNbRkNKYS6f9M1ob9030AvF4k",
      authDomain: "mega-boost-official-website.firebaseapp.com",
      databaseURL: "https://mega-boost-official-website-default-rtdb.firebaseio.com",
      projectId: "mega-boost-official-website",
      storageBucket: "mega-boost-official-website.firebasestorage.app",
      messagingSenderId: "220450956022",
      appId: "1:220450956022:web:c0d9cdc97ecefa1f2d02d7",
      measurementId: "G-LN9QJ0Y938"
    };

    // Initialize Firebase and Realtime DB
    let firebaseInitialized = false;
    let rdb, FIREBASE_DB_PATH = 'mega_store/projects';
    try {
        const fbApp = initializeApp(firebaseConfig);
        rdb = getDatabase(fbApp);
        firebaseInitialized = true;
        console.log("Firebase initialized");
    } catch (e) {
        console.log("Firebase init error:", e);
    }

    // --- GLOBAL API CONFIGURATION ---
    // Hum jsonbin.io use kar rahe hain jo ki free aur stable hai bina kisi account ke.
    const BIN_ID = '658b0f80dc7465401889980b'; // Yeh aapka unique global storage ID hai
    const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
    const DB_KEY = "MEGA_STORE_FINAL_DB";
    const COMMENT_KEY = "MEGA_STORE_COMMENTS";
    const USER_NAME_KEY = "MEGA_STORE_USER_NAME";
    
    let db = JSON.parse(localStorage.getItem(DB_KEY)) || [];
    let commentsDB = JSON.parse(localStorage.getItem(COMMENT_KEY)) || {};
    let currentTab = 'home';

    // Helper: sync local db -> Firebase
    async function syncToFirebase() {
        if(!firebaseInitialized) return;
        try {
            const ref = dbRef(rdb, FIREBASE_DB_PATH);
            await set(ref, db);
            console.log("Synced to Firebase");
        } catch (e) {
            console.log("Firebase write failed", e);
        }
    }

    // 1. App load hone par Cloud se data fetch karega (jsonbin fallback)
    async function initApp() {
        render(); // Pehle local dikhao fast loading ke liye

        // Attach Firebase realtime listener (agar available)
        if(firebaseInitialized) {
            try {
                const ref = dbRef(rdb, FIREBASE_DB_PATH);
                onValue(ref, (snapshot) => {
                    const val = snapshot.val();
                    if(val) {
                        // Firebase may store as array or object. Normalize to array.
                        if(Array.isArray(val)) {
                            db = val;
                        } else if(typeof val === 'object') {
                            // If stored as object with numeric keys, convert to array
                            try {
                                db = Object.values(val);
                            } catch(e) {
                                db = val;
                            }
                        } else {
                            db = val;
                        }
                        localStorage.setItem(DB_KEY, JSON.stringify(db));
                        render();
                        console.log("Data updated from Firebase realtime");
                    }
                }, (err) => {
                    console.log("Firebase listener error:", err);
                });
            } catch (e) {
                console.log("Firebase listener setup failed", e);
            }
        }

        // Still try jsonbin as fallback / historical data source
        try {
            const response = await fetch(API_URL + '/latest');
            const result = await response.json();
            if (result.record) {
                // If Firebase already provided data, we don't overwrite. Only use jsonbin if Firebase empty.
                const cloudDb = result.record;
                const hasLocal = (db && db.length > 0);
                if(!hasLocal || (Array.isArray(db) && db.length === 0)) {
                    db = cloudDb;
                    localStorage.setItem(DB_KEY, JSON.stringify(db));
                    render();
                }
            }
        } catch (error) {
            console.log("Cloud se connect nahi ho paya (jsonbin), local data use kar raha hoon.");
        }
    }

    window.onpopstate = function() { 
        if(document.getElementById('zoomOverlay').style.display === 'flex') {
            document.getElementById('zoomOverlay').style.display = 'none';
        } else {
            closeAll(); 
        }
    };

    function checkPass() {
        if(document.getElementById('adminPass').value === "7099756176") {
            closeAll(); document.getElementById('adminModal').style.display='flex'; renderAdmin();
        } else { alert("Wrong Password!"); }
    }
    function closeAll() { document.querySelectorAll('.modal, .modal-full').forEach(m => m.style.display='none'); }

    // 2. Data save karte waqt Cloud par bhi bhejega (jsonbin) AND Firebase
    async function saveData() {
        const name = document.getElementById('upName').value;
        const icon = document.getElementById('upIcon').value;
        if(!name || !icon) return alert("Name and Icon are required!");

        const p = {
            id: Date.now(),
            name: name,
            dev: document.getElementById('upDev').value,
            downs: document.getElementById('upDowns').value || "10K+",
            rating: document.getElementById('upRate').value || "4.5",
            icon: icon,
            banner: document.getElementById('upBanner').value,
            cat: document.getElementById('upCat').value,
            desc: document.getElementById('upDesc').value,
            dLink: document.getElementById('upLink').value || "#",
            ss: [1,2,3,4,5,6].map(i => document.getElementById('s'+i).value).filter(s => s)
        };
        
        db.unshift(p); 
        localStorage.setItem(DB_KEY, JSON.stringify(db));
        
        // --- API CALL TO SAVE GLOBALLY (jsonbin) ---
        try {
            await fetch(API_URL, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(db)
            });
            alert("App Saved Globally! Ab har browser mein dikhega (jsonbin).");
        } catch (error) {
            alert("Local save ho gaya par internet sync (jsonbin) nahi hua.");
        }

        // --- ALSO SYNC TO FIREBASE (realtime) ---
        await syncToFirebase();
        
        render(); renderAdmin(); 
    }

    function renderAdmin() {
        let h = "";
        db.forEach(p => { 
            h += `<div class="admin-item-card">
                <img src="${p.banner || p.icon}" class="admin-item-bg">
                <div class="admin-item-content">
                    <span>${p.name}</span>
                    <button class="del-btn-new" onclick="deleteP(${p.id})">DELETE</button>
                </div>
            </div>`; 
        });
        document.getElementById('admin-list').innerHTML = h;
    }

    async function deleteP(id) {
        if(confirm("Delete this project?")) {
            db = db.filter(x => x.id !== id);
            localStorage.setItem(DB_KEY, JSON.stringify(db));
            
            // Cloud se bhi delete karne ke liye sync (jsonbin)
            try {
                await fetch(API_URL, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(db)
                });
            } catch (e) {}

            // ALSO SYNC TO FIREBASE
            await syncToFirebase();
            
            render(); renderAdmin();
        }
    }

    function render() {
        const grids = { "Trending": "grid-trending", "New & Updated": "grid-new", "Editor's choice": "grid-editor" };
        const counts = { "Trending": 0, "New & Updated": 0, "Editor's choice": 0 };
        Object.values(grids).forEach(id => document.getElementById(id).innerHTML = "");
        document.getElementById('grid-top').innerHTML = ""; 
        document.getElementById('grid-all').innerHTML = "";
        
        db.forEach(p => {
            if(p.cat === "Top Project") {
                document.getElementById('grid-top').innerHTML += `<div class="top-banner-card" onclick="openDetail(${p.id})"><img src="${p.banner || p.icon}" onerror="this.src='https://via.placeholder.com/300x150'"><div class="banner-info">${p.name}</div></div>`;
            } else {
                const html = `<div class="app-card" onclick="openDetail(${p.id})"><div class="icon-box"><img src="${p.icon}"></div><div class="app-name">${p.name}</div><div class="app-star"><i class="fa-solid fa-star"></i> ${p.rating}</div></div>`;
                if(grids[p.cat] && counts[p.cat] < 5) {
                    document.getElementById(grids[p.cat]).innerHTML += html;
                    counts[p.cat]++;
                }
                document.getElementById('grid-all').innerHTML += html;
            }
        });
    }

    function openDetail(id) {
        const p = db.find(x => x.id === id);
        const comms = commentsDB[id] || [];
        const savedName = localStorage.getItem(USER_NAME_KEY) || "";
        
        history.pushState({p:1}, '');
        document.getElementById('detailContent').innerHTML = `
            <i class="fa-solid fa-arrow-left" onclick="history.back()" style="font-size:24px; cursor:pointer; margin-bottom:15px;"></i>
            <div style="display:flex; gap:15px; margin-bottom:20px; align-items:center;">
                <img src="${p.icon}" style="width:72px; height:72px; border-radius:18px;">
                <div><h3>${p.name}</h3><p style="color:var(--primary); font-size:13px;">${p.dev}</p></div>
            </div>
            <button class="btn-download" onclick="window.open('${p.dLink}')">Download</button>
            <div class="stat-box"><div><b>${p.rating} â˜…</b><br><small>Rating</small></div><div><b>${comms.length}</b><br><small>Comments</small></div><div><b>${p.downs}</b><br><small>Downloads</small></div></div>
            <h4 style="margin:15px 0 10px;">Screenshots</h4>
            <div style="display:flex; gap:10px; overflow-x:auto; scrollbar-width:none;">
                ${p.ss.map(s => `<img src="${s}" class="ss-img" onclick="zoomImage('${s}')">`).join('')}
            </div>
            <h4 style="margin:20px 0 10px;">About</h4><p style="color:gray; font-size:14px;">${p.desc}</p>
            
            <div class="comment-section">
                <h4>Comments</h4>
                <input type="text" id="cUserName" placeholder="Your Name" value="${savedName}" style="margin-bottom:5px;">
                <textarea id="cText" placeholder="Write a comment..." rows="2"></textarea>
                <button class="btn-download" style="margin:10px 0;" onclick="postComment(${id})">Post Comment</button>
                <div id="commentList">
                    ${comms.map(c => `
                        <div class="comment-item">
                            <div class="comment-user">${c.name}</div>
                            <div class="comment-text">${c.comment}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        document.getElementById('detailPage').style.display = 'block';
    }

    function zoomImage(src) {
        document.getElementById('zoomImg').src = src;
        document.getElementById('zoomOverlay').style.display = 'flex';
        history.pushState({zoom:1}, '');
    }

    function postComment(appId) {
        const nameInput = document.getElementById('cUserName').value;
        const commentInput = document.getElementById('cText').value;
        if(!nameInput || !commentInput) return alert("Please enter both name and comment.");
        localStorage.setItem(USER_NAME_KEY, nameInput);
        const newComment = { name: nameInput, comment: commentInput, date: new Date().toLocaleString() };
        if(!commentsDB[appId]) commentsDB[appId] = [];
        commentsDB[appId].unshift(newComment);
        localStorage.setItem(COMMENT_KEY, JSON.stringify(commentsDB));
        openDetail(appId); 
    }

    function doSearch() {
        let q = document.getElementById('searchInput').value.toLowerCase();
        let homeV = document.getElementById('home-view'), allV = document.getElementById('all-view'), searchV = document.getElementById('search-view'), res = document.getElementById('searchResults');
        if(q.length > 0) {
            homeV.style.display = 'none'; allV.style.display = 'none'; searchV.style.display = 'block';
            let html = "";
            db.filter(p => p.name.toLowerCase().includes(q)).forEach(p => {
                html += `<div class="app-card" onclick="openDetail(${p.id})"><div class="icon-box"><img src="${p.icon}"></div><div class="app-name">${p.name}</div><div class="app-star"><i class="fa-solid fa-star"></i> ${p.rating}</div></div>`;
            });
            res.innerHTML = html || "<p style='grid-column: span 3; color:gray; text-align:center;'>No Results</p>";
        } else {
            searchV.style.display = 'none';
            tab(currentTab, document.querySelector(`.nav-item[onclick*='${currentTab}']`));
        }
    }

    function tab(type, el) {
        currentTab = type;
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        if(el) el.classList.add('active');
        document.getElementById('search-view').style.display = 'none';
        document.getElementById('home-view').style.display = type === 'home' ? 'block' : 'none';
        document.getElementById('all-view').style.display = type === 'all' ? 'block' : 'none';
    }
    
    function goToAll() { tab('all', document.getElementById('nav-all')); }
    function openPass() { history.pushState({p:1}, ''); document.getElementById('passModal').style.display='flex'; }

    // --- expose module functions to global (so inline onclick handlers work) ---
    // This is the fix so your buttons and inline handlers work while keeping the script as module.
    window.initApp = initApp;
    window.checkPass = checkPass;
    window.closeAll = closeAll;
    window.saveData = saveData;
    window.renderAdmin = renderAdmin;
    window.deleteP = deleteP;
    window.openDetail = openDetail;
    window.zoomImage = zoomImage;
    window.postComment = postComment;
    window.doSearch = doSearch;
    window.tab = tab;
    window.goToAll = goToAll;
    window.openPass = openPass;
</script>
</body>
</html>